/* turn.js r4 | Copyright (c) 2012 Emmanuel Garcia | turnjs.com | turnjs.com/legal.txt */
(function(g){function O(a,b,c){if(!c[0]||"object"==typeof c[0])return b.init.apply(a,c);if(b[c[0]])return b[c[0]].apply(a,Array.prototype.slice.call(c,1));throw n(c[0]+" is an invalid value");}function k(a,b,c,d){return{css:{position:"absolute",top:a,left:b,overflow:d||"hidden",zIndex:c||"auto"}}}function P(a,b,c,d,e){var f=1-e,Q=f*f*f,g=e*e*e;return j(Math.round(Q*a.x+3*e*f*f*b.x+3*e*e*f*c.x+g*d.x),Math.round(Q*a.y+3*e*f*f*b.y+3*e*e*f*c.y+g*d.y))}function j(a,b){return{x:a,y:b}}function o(a,b,c){return z&&
c?" translate3d("+a+"px,"+b+"px, 0px) ":" translate("+a+"px, "+b+"px) "}function p(a){return" rotate("+a+"deg) "}function m(a,b){return Object.prototype.hasOwnProperty.call(b,a)}function R(){for(var a=["Moz","Webkit","Khtml","O","ms"],b=a.length,c="";b--;)a[b]+"Transform"in document.body.style&&(c="-"+a[b].toLowerCase()+"-");return c}function M(a,b,c,d,e){var f,g=[];if("-webkit-"==w){for(f=0;f<e;f++)g.push("color-stop("+d[f][0]+", "+d[f][1]+")");a.css({"background-image":"-webkit-gradient(linear, "+
b.x+"% "+b.y+"%,"+c.x+"% "+c.y+"%, "+g.join(",")+" )"})}else{var b={x:b.x/100*a.width(),y:b.y/100*a.height()},c={x:c.x/100*a.width(),y:c.y/100*a.height()},G=c.x-b.x;f=c.y-b.y;var h=Math.atan2(f,G),i=h-Math.PI/2,i=Math.abs(a.width()*Math.sin(i))+Math.abs(a.height()*Math.cos(i)),G=Math.sqrt(f*f+G*G),c=j(c.x<b.x?a.width():0,c.y<b.y?a.height():0),s=Math.tan(h);f=-1/s;s=(f*c.x-c.y-s*b.x+b.y)/(f-s);c=f*s-f*c.x+c.y;b=Math.sqrt(Math.pow(s-b.x,2)+Math.pow(c-b.y,2));for(f=0;f<e;f++)g.push(" "+d[f][1]+" "+100*
(b+G*d[f][0])/i+"%");a.css({"background-image":w+"linear-gradient("+-h+"rad,"+g.join(",")+")"})}}function n(a){function b(a){this.name="TurnJsError";this.message=a}b.prototype=Error();b.prototype.constructor=b;return new b(a)}function S(a){var b={top:0,left:0};do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent);return b}var z,w="",J=Math.PI,E=J/2,t="Touch"in window,q=t?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",
up:"mouseup",over:"mouseover",out:"mouseout"},T={backward:["bl","tl","l"],forward:["br","tr","r"],all:"tl,bl,tr,br,l,r".split(",")},U=["single","double"],V={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,when:null},W={acceleration:!0,corners:"forward",cornerSize:100,duration:600,gradients:!0},h={init:function(a){z="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style;w=R();var b,c=0,d=this.data(),e=this.children(),a=g.extend({width:this.width(),height:this.height()},
V,a);d.opts=a;d.pageObjs={};d.pages={};d.pageWrap={};d.pagePlace={};d.pageMv=[];d.zoom=1;d.totalPages=a.pages||0;d.docEvents={mouseStart:function(a){for(var b in d.pages)if(m(b,d.pages)&&!1===i._eventStart.call(d.pages[b],a))return!1},mouseMove:function(a){for(var b in d.pages)m(b,d.pages)&&i._eventMove.call(d.pages[b],a)},mouseEnd:function(a){for(var b in d.pages)m(b,d.pages)&&i._eventEnd.call(d.pages[b],a)}};if(a.when)for(b in a.when)m(b,a.when)&&this.bind(b,a.when[b]);this.css({position:"relative",
width:a.width,height:a.height});this.turn("display",a.display);z&&!t&&a.acceleration&&this.transform(o(0,0,!0));for(b=0;b<e.length;b++)"1"!=g(e[b]).attr("ignore")&&this.turn("addPage",e[b],++c);this.turn("page",a.page);g(this).bind(q.down,d.docEvents.mouseStart).bind("start",h._start).bind("end",h._end).bind("pressed",h._pressed).bind("released",h._released).bind("flip",h._flip);g(document).bind(q.move,d.docEvents.mouseMove).bind(q.up,d.docEvents.mouseEnd);d.done=!0;return this},addPage:function(a,
b){var c,d=!1,e=this.data(),f=e.totalPages+1;if(e.destroying)return!1;if(c=/\bp([0-9]+)\b/.exec(g(a).attr("class")))b=parseInt(c[1],10);if(b)if(b==f)d=!0;else{if(b>f)throw n('Page "'+b+'" cannot be inserted');}else b=f,d=!0;1<=b&&b<=f&&(c="double"==e.display?b%2?" odd":" even":"",e.done&&this.turn("stop"),b in e.pageObjs&&h._movePages.call(this,b,1),d&&(e.totalPages=f),e.pageObjs[b]=g(a).css({"float":"left"}).addClass("page p"+b+c),h._addPage.call(this,b),e.done&&this.turn("update"),h._removeFromDOM.call(this));
return this},_addPage:function(a){var b=this.data(),c=b.pageObjs[a];if(c)if(h._necessPage.call(this,a)){if(!b.pageWrap[a]){var d=h._pageSize.call(this,a,!0);c.css({width:d.width,height:d.height});b.pagePlace[a]=a;b.pageWrap[a]=g("<div/>",{"class":"page-wrapper",page:a,css:{position:"absolute",overflow:"hidden"}}).css(d);this.append(b.pageWrap[a]);b.pageObjs[a].appendTo(b.pageWrap[a])}(!a||1==h._setPageLoc.call(this,a))&&h._makeFlip.call(this,a)}else b.pagePlace[a]=0,b.pageObjs[a]&&b.pageObjs[a].remove()},
hasPage:function(a){return m(a,this.data().pageObjs)},center:function(a){var b=this.data(),c=g(this).turn("size"),d=c.width/(2*b.zoom)-c.width/2;"double"==b.display&&(a=this.turn("view",a||b.tpage||b.page),a[0]?a[1]||(d+=c.width/4):d-=c.width/4);g(this).css({marginLeft:d});return this},destroy:function(){var a=this,b=this.data();b.destroying=!0;g.each("end,first,flip,last,pressed,released,start,turning,turned,zooming,missing".split(","),function(b,d){a.unbind(d)});for(g(document).unbind(q.move,b.docEvents.mouseMove).unbind(q.up,
b.docEvents.mouseEnd);0!==b.totalPages;)this.turn("removePage",b.totalPages);b.fparent&&b.fparent.remove();b.shadow&&b.shadow.remove();this.removeData();b=null;return this},is:function(){return"object"==typeof this.data().pages},zoom:function(a){var b=this.data();if("number"==typeof a){if(0.0010>a||100<a)throw n(a+" is not a value for zoom");var c=g.Event("zooming");this.trigger(c,[a,b.zoom]);if(c.isDefaultPrevented())return this;var c=g(this).turn("size"),d=1/b.zoom,e=c.width*d*a,f=c.height*d*a;
b.zoom=a;g(this).turn("stop").turn("size",e,f).css({marginTop:c.height*d/2-f/2});b.opts.autoCenter?this.turn("center"):g(this).css({marginLeft:c.width*d/2-e/2});return this}return b.zoom},_pageSize:function(a,b){var c=this.data(),d={};if("single"==c.display)d.width=this.width(),d.height=this.height(),b&&(d.top=0,d.left=0,d.right="auto");else{var e=this.width()/2,f=this.height();c.pageObjs[a].hasClass("own-size")?(d.width=c.pageObjs[a].width(),d.height=c.pageObjs[a].height()):(d.width=e,d.height=f);
b&&(c=a%2,d.top=(f-d.height)/2,d[c?"right":"left"]=e-d.width,d[c?"left":"right"]="auto")}return d},_makeFlip:function(a){var b=this.data();if(!b.pages[a]&&b.pagePlace[a]==a){var c,d="single"==b.display,e=a%2;b.pageObjs[a].hasClass("hard")?c=e?"r":"l":(b.pageObjs[a].addClass("sheet"),c=d?"all":e?"forward":"backward");b.pages[a]=b.pageObjs[a].css(h._pageSize.call(this,a)).flip({page:a,next:e||d?a+1:a-1,turn:this,duration:b.opts.duration,acceleration:b.opts.acceleration,corners:c,gradients:b.opts.gradients}).flip("disable",
b.disabled)}return b.pages[a]},_makeRange:function(){var a,b;if(!(1>this.data().totalPages)){b=this.turn("range");for(a=b[0];a<=b[1];a++)h._addPage.call(this,a)}},range:function(a){var b,c,d,e=this.data(),a=a||e.tpage||e.page||1;d=h._view.call(this,a);if(1>a||a>e.totalPages)throw n('"'+a+'" is not a page for range');d[1]=d[1]||d[0];1<=d[0]&&d[1]<=e.totalPages?(a=Math.floor(2),e.totalPages-d[1]>d[0]?(b=Math.min(d[0]-1,a),c=2*a-b):(c=Math.min(e.totalPages-d[1],a),b=2*a-c)):c=b=5;return[Math.max(1,d[0]-
b),Math.min(e.totalPages,d[1]+c)]},_necessPage:function(a){if(0===a)return!0;var b=this.turn("range");return this.data().pageObjs[a].hasClass("fixed")||a>=b[0]&&a<=b[1]},_removeFromDOM:function(){var a,b=this.data();for(a in b.pageWrap)m(a,b.pageWrap)&&!h._necessPage.call(this,a)&&h._removePageFromDOM.call(this,a)},_removePageFromDOM:function(a){var b=this.data();if(b.pages[a]){var c=b.pages[a].data();i._moveFoldingPage.call(b.pages[a],!1);c.f&&c.f.fwrapper&&c.f.fwrapper.remove();b.pages[a].removeData();
b.pages[a].remove();delete b.pages[a]}b.pageObjs[a]&&b.pageObjs[a].remove();b.pageWrap[a]&&(b.pageWrap[a].remove(),delete b.pageWrap[a]);delete b.pagePlace[a]},removePage:function(a){var b=this.data();if(1>a||a>b.totalPages)throw n("The page "+a+" doesn't exist");b.pageObjs[a]&&(this.turn("stop"),h._removePageFromDOM.call(this,a),delete b.pageObjs[a]);h._movePages.call(this,a,-1);b.totalPages-=1;b.page>b.totalPages?this.turn("page",b.totalPages):h._makeRange.call(this);return this},_movePages:function(a,
b){var c,d=this,e=this.data(),f="single"==e.display,g=function(a){var c=a+b,g=c%2,i=g?" odd ":" even ";e.pageObjs[a]&&(e.pageObjs[c]=e.pageObjs[a].removeClass("p"+a+" odd even").addClass("p"+c+i));e.pagePlace[a]&&e.pageWrap[a]&&(e.pagePlace[c]=c,e.pageWrap[c]=e.pageObjs[c].hasClass("fixed")?e.pageWrap[a].attr("page",c):e.pageWrap[a].css(h._pageSize.call(d,c,!0)).attr("page",c),e.pages[a]&&(e.pages[c]=e.pages[a].flip("options",{page:c,next:f||g?c+1:c-1,corners:f?"all":g?"forward":"backward"})),b&&
(delete e.pages[a],delete e.pagePlace[a],delete e.pageObjs[a],delete e.pageWrap[a],delete e.pageObjs[a]))};if(0<b)for(c=e.totalPages;c>=a;c--)g(c);else for(c=a;c<=e.totalPages;c++)g(c)},display:function(a){var b=this.data(),c=b.display;if(a){if(-1==g.inArray(a,U))throw n('"'+a+'" is not a value for display');"single"==a?b.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),b.pageObjs[0]=g("<div />",{"class":"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)):b.pageObjs[0]&&
(this.turn("stop").css({overflow:""}),b.pageObjs[0].remove(),delete b.pageObjs[0]);b.display=a;c&&(a=this.turn("size"),h._movePages.call(this,1,0),this.turn("size",a.width,a.height).turn("update"));return this}return c},animating:function(){return 0<this.data().pageMv.length},disable:function(a){var b,c=this.data(),d=this.turn("view");c.disabled=void 0===a||!0===a;for(b in c.pages)m(b,c.pages)&&c.pages[b].flip("disable",c.disabled?!0:-1==g.inArray(parseInt(b,10),d));return this},size:function(a,b){if(a&&
b){var c,d,e=this.data();d="double"==e.display?a/2:a;this.css({width:a,height:b});e.pageObjs[0]&&e.pageObjs[0].css({width:d,height:b});for(c in e.pageWrap)m(c,e.pageWrap)&&(d=h._pageSize.call(this,c,!0),e.pageObjs[c].css({width:d.width,height:d.height}),e.pageWrap[c].css(d),e.pages[c]&&e.pages[c].css({width:d.width,height:d.height}));this.turn("resize");return this}return{width:this.width(),height:this.height()}},resize:function(){var a,b=this.data();b.pages[0]&&(b.pageWrap[0].css({left:-this.width()}),
b.pages[0].flip("resize",!0));for(a=1;a<=b.totalPages;a++)b.pages[a]&&b.pages[a].flip("resize",!0)},_removeMv:function(a){var b,c=this.data();for(b=0;b<c.pageMv.length;b++)if(c.pageMv[b]==a)return c.pageMv.splice(b,1),!0;return!1},_addMv:function(a){var b=this.data();h._removeMv.call(this,a);b.pageMv.push(a)},_view:function(a){var b=this.data(),a=a||b.page;return"double"==b.display?a%2?[a-1,a]:[a,a+1]:[a]},view:function(a){var b=this.data(),a=h._view.call(this,a);return"double"==b.display?[0<a[0]?
a[0]:0,a[1]<=b.totalPages?a[1]:0]:[0<a[0]&&a[0]<=b.totalPages?a[0]:0]},stop:function(a){var b,c,d,e=this.data();e.tpage&&(e.page=e.tpage,delete e.tpage);for(b=0;b<e.pageMv.length;b++)e.pageMv[b]!==a&&(d=e.pages[e.pageMv[b]],c=d.data().f.opts,d.flip("hideFoldedPage",!1),i._moveFoldingPage.call(d,!1),c.force&&(c.next=0===c.page%2?c.page-1:c.page+1,delete c.force),e.pageMv.splice(b,1),b--);this.turn("update");return this},pages:function(a){var b=this.data();if(a){if(a<b.totalPages){for(var c=a+1;c<=
b.totalPages;c++)this.turn("removePage",c);this.turn("page")>a&&this.turn("page",a)}b.totalPages=a;return this}return b.totalPages},_missing:function(a){for(var b=this.data(),c=this.turn("range",a),d=[],a=c[0];a<=c[1];a++)b.pageObjs[a]||d.push(a);0<d.length&&this.trigger("missing",[d])},_fitPage:function(a){var b=this.data(),c=this.turn("view",a);h._missing.call(this,a);b.pageObjs[a]&&(b.page=a,this.turn("stop"),h._removeFromDOM.call(this),h._makeRange.call(this),h._updateShadow.call(this),this.trigger("turned",
[a,c]),b.opts.autoCenter&&this.turn("center"))},_turnPage:function(a,b){var c,d,e=this.data(),f=e.pagePlace[a],i=this.turn("view"),j=this.turn("view",a);if(e.page!=a){var H=e.page,A=g.Event("turning");this.trigger(A,[a,j]);if(A.isDefaultPrevented()){H==e.page&&-1!=g.inArray(f,e.pageMv)&&e.pages[f].flip("hideFoldedPage",!0);return}-1!=g.inArray(1,j)&&this.trigger("first");-1!=g.inArray(e.totalPages,j)&&this.trigger("last")}if(b)this.turn("stop",f);else{h._missing.call(this,a);if(!e.pageObjs[a])return;
this.turn("stop");e.page=a}h._makeRange.call(this);"single"==e.display?(c=i[0],d=j[0]):i[1]&&a>i[1]?(c=i[1],d=j[0]):i[0]&&a<i[0]&&(c=i[0],d=j[1]);e.pages[c]&&(f=e.pages[c].data().f.opts,e.tpage=d,f.next!=d&&(f.next=d,f.force=!0),"single"==e.display?e.pages[c].flip("turnPage",j[0]>i[0]?"br":"bl"):e.pages[c].flip("turnPage"))},page:function(a){var b=this.data();if(void 0===a)return b.page;if(!b.disabled&&!b.destroying){a=parseInt(a,10);if(0<a&&a<=b.totalPages)return a!=b.page&&(!b.done||-1!=g.inArray(a,
this.turn("view"))?h._fitPage.call(this,a):h._turnPage.call(this,a)),this;throw n("The page "+a+" doesn't exist");}},next:function(){return this.turn("page",Math.min(this.data().totalPages,h._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,h._view.call(this,this.data().page).shift()-1))},_addMotionPage:function(){var a=g(this).data().f.opts,b=a.turn;b.data();h._addMv.call(b,a.page)},_start:function(a,b,c){var d=b.turn.data();a.isDefaultPrevented()||
("single"==d.display&&(c="l"==c.charAt(1),1==b.page&&c||b.page==d.pages&&!c?a.preventDefault():c?(b.next=b.next<b.page?b.next:b.page-1,b.force=!0):b.next=b.next>b.page?b.next:b.page+1),h._addMotionPage.call(a.target),h._updateShadow.call(b.turn))},_end:function(a,b,c){g(a.target).data();var a=b.turn,d=a.data();if(c||d.tpage){if(d.tpage==b.next||d.tpage==b.page)c=d.tpage,delete d.tpage,h._fitPage.call(a,c||b.next,!0)}else h._removeMv.call(a,b.page),h._updateShadow.call(a),a.turn("update")},_pressed:function(a){a.stopPropagation();
var b,a=g(a.target).data().f,c=a.opts.turn.data().pages;for(b in c)b!=a.opts.page&&c[b].flip("disable",!0);return a.time=(new Date).getTime()},_released:function(a,b){a.stopPropagation();var c=g(a.target).data().f;if(200>(new Date).getTime()-c.time||0>b.x||b.x>g(a.target).width())a.preventDefault(),h._turnPage.call(c.opts.turn,c.opts.next,!0)},_flip:function(a){a.stopPropagation();a=g(a.target).data().f.opts;a.turn.trigger("turn",[a.next]);a.turn.data().opts.autoCenter&&a.turn.turn("center",a.next)},
calculateZ:function(a){var b,c,d,e,f=this,g=this.data();b=this.turn("view");var i=b[0]||b[1],h={pageZ:{},partZ:{},pageV:{}},j=function(a){a=f.turn("view",a);a[0]&&(h.pageV[a[0]]=!0);a[1]&&(h.pageV[a[1]]=!0)};for(b=0;b<a.length;b++)c=a[b],d=g.pages[c].data().f.opts.next,e=g.pagePlace[c],j(c),j(d),c=g.pagePlace[d]==d?d:c,h.pageZ[c]=g.totalPages-Math.abs(i-c),h.partZ[e]=2*g.totalPages+Math.abs(i-c);return h},update:function(){var a,b=this.data();if(b.pageMv.length&&0!==b.pageMv[0]){var c,d=this.turn("calculateZ",
b.pageMv);this.turn("view",b.tpage);for(a in b.pageWrap)if(m(a,b.pageWrap)&&(c=b.pageObjs[a].hasClass("fixed"),b.pageWrap[a].css({display:d.pageV[a]||c?"":"none",zIndex:d.pageZ[a]||(c?-1:0)}),c=b.pages[a]))c.flip("z",d.partZ[a]||null),d.pageV[a]&&c.flip("resize"),b.tpage&&c.flip("disable",!0)}else for(a in b.pageWrap)m(a,b.pageWrap)&&(d=h._setPageLoc.call(this,a),b.pages[a]&&b.pages[a].flip("disable",b.disabled||1!=d).flip("z",null));return this},_updateShadow:function(){var a,b,c=this.data(),d=this.width(),
e=this.height(),f="single"==c.display?d:d/2;a=this.turn("view");c.shadow||(c.shadow=g("<div />",{"class":"shadow",css:k(0,0,0).css}).appendTo(this));for(var i=0;i<c.pageMv.length&&a[0]&&a[1];i++){a=this.turn("view",c.pages[c.pageMv[i]].data().f.opts.next);b=this.turn("view",c.pageMv[i]);a[0]=a[0]&&b[0];a[1]=a[1]&&b[1]}a[0]?a[1]?c.shadow.css({width:d,height:e,top:0,left:0}):c.shadow.css({width:f,height:e,top:0,left:0}):c.shadow.css({width:f,height:e,top:0,left:f})},_setPageLoc:function(a){var b=this.data(),
c=this.turn("view"),d=0;if(a==c[0]||a==c[1])d=1;else if("single"==b.display&&a==c[0]+1||"double"==b.display&&a==c[0]-2||a==c[1]+2)d=2;if(!this.turn("animating"))switch(d){case 1:b.pageWrap[a].css({zIndex:b.totalPages,display:""});break;case 2:b.pageWrap[a].css({zIndex:b.totalPages-1,display:""});break;case 0:b.pageWrap[a].css({zIndex:0,display:b.pageObjs[a].hasClass("fixed")?"":"none"})}return d}},i={init:function(a){this.data({f:{effect:"r"==a.corners||"l"==a.corners?"hard":"sheet"}});this.flip("options",
a);i._addPageWrapper.call(this);return this},setData:function(a){var b=this.data();b.f=g.extend(b.f,a);return this},options:function(a){var b=this.data().f;return a?(i.setData.call(this,{opts:g.extend({},b.opts||W,a)}),this):b.opts},z:function(a){var b=this.data().f;b.fwrapper&&(b.opts["z-index"]=a,b.fwrapper.css({zIndex:a||parseInt(b.parent.css("z-index"),10)||0}));return this},_cAllowed:function(){return T[this.data().f.opts.corners]||this.data().f.opts.corners},_cornerActivated:function(a){var a=
t&&a.originalEvent?a.originalEvent.touches:[a],b=this.data().f,c=b.parent.offset(),d=this.width(),e=this.height(),a={x:Math.max(0,a[0].pageX-c.left),y:Math.max(0,a[0].pageY-c.top)},c=b.opts.cornerSize;if(0>=a.x||0>=a.y||a.x>=d||a.y>=e)return!1;var f=i._cAllowed.call(this);switch(b.effect){case "hard":if(a.x>d-c)a.corner="r";else if(a.x<c)a.corner="l";else return!1;break;case "sheet":if(a.y<c)a.corner="t";else if(a.y>=e-c)a.corner="b";else return!1;if(a.x<=c)a.corner+="l";else if(a.x>=d-c)a.corner+=
"r";else return!1}return-1==g.inArray(a.corner,f)?!1:a},_c:function(a,b){b=b||0;switch(a){case "tl":return j(b,b);case "tr":return j(this.width()-b,b);case "bl":return j(b,this.height()-b);case "br":return j(this.width()-b,this.height()-b);case "l":return j(b,0);case "r":return j(this.width()-b,0)}},_c2:function(a){switch(a){case "tl":return j(2*this.width(),0);case "tr":return j(-this.width(),0);case "bl":return j(2*this.width(),this.height());case "br":return j(-this.width(),this.height());case "l":return j(2*
this.width(),0);case "r":return j(-this.width(),0)}},_foldingPage:function(){var a=this.data().f,b=a.opts;if(b.turn)return a=b.turn.data(),"single"==a.display?a.pageObjs[b.next]?a.pageObjs[0]:null:a.pageObjs[b.next]},_backGradient:function(){var a=this.data().f,b=a.opts.turn;if((b=a.opts.gradients&&(!b||"single"==b.data().display||2!=a.opts.page&&a.opts.page!=b.data().totalPages-1))&&!a.bshadow)a.bshadow=g("<div/>",k(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(a.parent);
return b},resize:function(a){var b=this.data().f,c=this.width(),d=this.height();switch(b.effect){case "hard":a&&(b.wrapper.css({width:c,height:d}),b.fpage.css({width:c,height:d}),b.opts.gradients&&(b.ashadow.css({width:c,height:d}),b.bshadow.css({width:c,height:d})));break;case "sheet":a&&(a=Math.round(Math.sqrt(Math.pow(c,2)+Math.pow(d,2))),b.wrapper.css({width:a,height:a}),b.fwrapper.css({width:a,height:a}).children(":first-child").css({width:c,height:d}),b.fpage.css({width:d,height:c}),b.opts.gradients&&
b.ashadow.css({width:d,height:c}),i._backGradient.call(this)&&b.bshadow.css({width:c,height:d})),b.parent.is(":visible")&&(c=S(b.parent[0]),b.fwrapper.css({top:c.top,left:c.left}),b.opts.turn&&(c=S(b.opts.turn[0]),b.fparent.css({top:-c.top,left:-c.left}))),this.flip("z",b.opts["z-index"])}},_addPageWrapper:function(){var a=this.data().f,b=this.parent();a.parent=b;if(!a.wrapper)switch(a.effect){case "hard":var c={};c[w+"transform-style"]="preserve-3d";c[w+"backface-visibility"]="hidden";a.wrapper=
g("<div/>",k(0,0,2)).css(c).appendTo(b).prepend(this);a.fpage=g("<div/>",k(0,0,1)).css(c).appendTo(b);a.opts.gradients&&(a.ashadow=g("<div/>",k(0,0,0)).hide().appendTo(b),a.bshadow=g("<div/>",k(0,0,0)));break;case "sheet":var c=this.width(),d=this.height();Math.round(Math.sqrt(Math.pow(c,2)+Math.pow(d,2)));a.fparent=a.opts.turn.data().fparent;a.fparent||(c=g("<div/>",{css:{"pointer-events":"none"}}).hide(),c.data().flips=0,c.css(k(0,0,"auto","visible").css).appendTo(a.opts.turn),a.opts.turn.data().fparent=
c,a.fparent=c);this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"});a.wrapper=g("<div/>",k(0,0,this.css("z-index"))).appendTo(b).prepend(this);a.fwrapper=g("<div/>",k(b.offset().top,b.offset().left)).hide().appendTo(a.fparent);a.fpage=g("<div/>",{css:{cursor:"default"}}).appendTo(g("<div/>",k(0,0,0,"visible")).appendTo(a.fwrapper));a.opts.gradients&&(a.ashadow=g("<div/>",k(0,0,1)).appendTo(a.fpage));i.setData.call(this,a)}i.resize.call(this,!0)},_fold:function(a){var b=this.data().f,
c=i._c.call(this,a.corner),d=this.width(),e=this.height();switch(b.effect){case "hard":a.x="l"==a.corner?Math.min(Math.max(a.x,0),2*d):Math.max(Math.min(a.x,d),-d);var f,g,h,H,A,s={overflow:"visible"},F=b.opts.turn.data().totalPages,k=c.x?(c.x-a.x)/d:a.x/d,m=90*k,n=90>m;switch(a.corner){case "l":H="0% 50%";A="100% 50%";n?(f=0,g=0<b.opts.next-1,h=1):(f="100%",g=b.opts.page+1<F,h=0);break;case "r":H="100% 50%",A="0% 50%",m=-m,d=-d,n?(f=0,g=b.opts.next+1<F,h=0):(f="-100%",g=1!=b.opts.page,h=1)}s[w+"perspective-origin"]=
A;b.wrapper.transform("rotateY("+m+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",A);b.fpage.transform("translateX("+d+"px) rotateY("+(180+m)+"deg)",H);b.parent.css(s);n?(k=-k+1,b.wrapper.css({zIndex:F}),b.fpage.css({zIndex:F-1})):(k-=1,b.wrapper.css({zIndex:F-1}),b.fpage.css({zIndex:F}));b.opts.gradients&&(g?b.ashadow.css({display:"",left:f,backgroundColor:"rgba(0,0,0,"+0.5*k+")"}).transform("rotateY(0deg)"):b.ashadow.hide(),b.bshadow.css({opacity:-k+1}),n?b.bshadow.parent()[0]!=b.wrapper[0]&&
b.bshadow.appendTo(b.wrapper):b.bshadow.parent()[0]!=b.fpage[0]&&b.bshadow.appendTo(b.fpage),M(b.bshadow,j(100*h,0),j(100*(-h+1),0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2));break;case "sheet":var q=this,u=0,t,B,C,K,x,L,v=j(0,0),z=j(0,0),l=j(0,0);f=i._foldingPage.call(this);Math.tan(0);var r=b.opts.acceleration,N=b.wrapper.height(),D="t"==a.corner.substr(0,1),y="l"==a.corner.substr(1,1),I=function(){var f=j(c.x?c.x-a.x:a.x,c.y?c.y-a.y:a.y),g=j(y?d-f.x/2:a.x+f.x/2,f.y/2),h=2>f.x&&2>f.y?E/2:E-
Math.atan2(f.y,f.x),k=h-Math.atan2(g.y,g.x),k=Math.max(0,Math.sin(k)*Math.sqrt(Math.pow(g.x,2)+Math.pow(g.y,2)));u=180*(h/J);l=j(k*Math.sin(h),k*Math.cos(h));if(h>E&&(l.x+=Math.abs(l.y*f.y/f.x),l.y=0,Math.round(l.x*Math.tan(J-h))<e))return a.y=Math.sqrt(Math.pow(e,2)+2*g.x*f.x),D&&(a.y=e-a.y),I();h>E&&(f=J-h,g=N-e/Math.sin(f),v=j(Math.round(g*Math.cos(f)),Math.round(g*Math.sin(f))),y&&(v.x=-v.x),D&&(v.y=-v.y));t=Math.round(l.y/Math.tan(h)+l.x);f=d-t;g=f*Math.cos(2*h);k=f*Math.sin(2*h);z=j(Math.round(y?
f-g:t+g),Math.round(D?k:e-k));x=f*Math.sin(h);f=i._c2.call(q,a.corner);f=Math.sqrt(Math.pow(f.x-a.x,2)+Math.pow(f.y-a.y,2));L=f<d?f/d:1;b.opts.gradients&&(K=100<x?(x-100)/x:0,B=j(100*(x*Math.sin(E-h)/e),100*(x*Math.cos(E-h)/d)),D&&(B.y=100-B.y),y&&(B.x=100-B.x));i._backGradient.call(q)&&(C=j(100*(x*Math.sin(h)/d),100*(x*Math.cos(h)/e)),y||(C.x=100-C.x),D||(C.y=100-C.y));l.x=Math.round(l.x);l.y=Math.round(l.y);return!0};g=function(a,c,f,g){var h=["0","auto"],k=(d-N)*f[0]/100,l=(e-N)*f[1]/100,c={left:h[c[0]],
top:h[c[1]],right:h[c[2]],bottom:h[c[3]]},h=90!=g&&-90!=g?y?-1:1:0,f=f[0]+"% "+f[1]+"%";q.css(c).transform(p(g)+o(a.x+h,a.y,r),f);b.fpage.parent().css(c);b.wrapper.transform(o(-a.x+k-h,-a.y+l,r)+p(-g),f);b.fwrapper.transform(o(-a.x+v.x+k,-a.y+v.y+l,r)+p(-g),f);b.fpage.parent().transform(p(g)+o(a.x+z.x-v.x,a.y+z.y-v.y,r),f);b.opts.gradients&&M(b.ashadow,j(y?100:0,D?100:0),j(B.x,B.y),[[K,"rgba(0,0,0,0)"],[0.8*(1-K)+K,"rgba(0,0,0,"+0.2*L+")"],[1,"rgba(255,255,255,"+0.2*L+")"]],3,0);i._backGradient.call(q)&&
M(b.bshadow,j(y?0:100,D?0:100),j(C.x,C.y),[[0.8,"rgba(0,0,0,0)"],[1,"rgba(0,0,0,"+0.3*L+")"],[1,"rgba(0,0,0,0)"]],3)};switch(a.corner){case "tl":a.x=Math.max(a.x,1);I();g(l,[1,0,0,1],[100,0],u);b.fpage.transform(o(-e,-d,r)+p(90-2*u),"100% 100%");f.transform(p(90)+o(0,-e,r),"0% 0%");break;case "tr":a.x=Math.min(a.x,d-1);I();g(j(-l.x,l.y),[0,0,0,1],[0,0],-u);b.fpage.transform(o(0,-d,r)+p(-90+2*u),"0% 100%");f.transform(p(270)+o(-d,0,r),"0% 0%");break;case "bl":a.x=Math.max(a.x,1);I();g(j(l.x,-l.y),
[1,1,0,0],[100,100],-u);b.fpage.transform(o(-e,0,r)+p(-90+2*u),"100% 0%");f.transform(p(270)+o(-d,0,r),"0% 0%");break;case "br":a.x=Math.min(a.x,d-1),I(),g(j(-l.x,-l.y),[0,1,1,0],[0,100],u),b.fpage.transform(p(90-2*u),"0% 0%"),f.transform(p(90)+o(0,-e,r),"0% 0%")}}b.point=a},_moveFoldingPage:function(a){var b=this.data().f;if(b){var c=b.opts.turn,d=c.data(),e=d.pagePlace;a?(d=b.opts.next,e[d]!=b.opts.page&&(i._foldingPage.call(this).appendTo(b.fpage),e[d]=b.opts.page,i.setData.call(this,{folding:d})),
c.turn("update")):b.folding&&(d.pages[b.folding]?(c=d.pages[b.folding].data().f,d.pageObjs[b.folding].appendTo(c.wrapper)):d.pageWrap[b.folding]&&d.pageObjs[b.folding].appendTo(d.pageWrap[b.folding]),b.folding in e&&(e[b.folding]=b.folding),delete b.folding)}},_showFoldedPage:function(a,b){var c=i._foldingPage.call(this),d=this.data(),e=d.f;if(!e.point||e.point.corner!=a.corner){var f=g.Event("start");this.trigger(f,[e.opts,a.corner]);if(f.isDefaultPrevented())return!1}if(c){if(b){var h=this,c=e.point&&
e.point.corner==a.corner?e.point:i._c.call(this,a.corner,1);this.animatef({from:[c.x,c.y],to:[a.x,a.y],duration:500,frame:function(b){a.x=Math.round(b[0]);a.y=Math.round(b[1]);i._fold.call(h,a)}})}else i._fold.call(this,a),d.effect&&!d.effect.turning&&this.animatef(!1);if(!e.visible)switch(e.effect){case "hard":e.visible=!0;i._moveFoldingPage.call(this,!0);e.fpage.show();e.opts.shadows&&e.bshadow.show();break;case "sheet":e.visible=!0,e.fparent.show().data().flips++,i._moveFoldingPage.call(this,!0),
e.fwrapper.show(),e.bshadow&&e.bshadow.show()}return!0}return!1},hide:function(){var a=this.data().f,b=i._foldingPage.call(this);switch(a.effect){case "hard":a.opts.gradients&&(a.bshadowLoc=0,a.bshadow.remove(),a.ashadow.hide());a.wrapper.transform("");a.fpage.hide();break;case "sheet":0===--a.fparent.data().flips&&a.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform(""),a.wrapper.transform(""),a.fwrapper.hide(),a.bshadow&&a.bshadow.hide(),b.transform("")}a.visible=!1;return this},
hideFoldedPage:function(a){var b=this.data().f;if(b.point){var c=this,d=b.point,e=function(){b.point=null;c.flip("hide");c.trigger("end",[b.opts,!1])};if(a){var f=i._c.call(this,d.corner),a="t"==d.corner.substr(0,1)?Math.min(0,d.y-f.y)/2:Math.max(0,d.y-f.y)/2,g=j(d.x,d.y+a),h=j(f.x,f.y-a);this.animatef({from:0,to:1,frame:function(a){a=P(d,g,h,f,a);d.x=a.x;d.y=a.y;i._fold.call(c,d)},complete:e,duration:800,hiding:!0})}else this.animatef(!1),e()}},turnPage:function(a){var b=this,c=this.data().f,a={corner:c.corner?
c.corner.corner:a||i._cAllowed.call(this)[0]},d=c.point||i._c.call(this,a.corner,c.opts.turn?c.opts.turn.data().opts.elevation:0),e=i._c2.call(this,a.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(c){c=P(d,d,e,e,c);a.x=c.x;a.y=c.y;i._showFoldedPage.call(b,a)},complete:function(){b.trigger("end",[c.opts,!0])},duration:c.opts.duration,turning:!0});c.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},
_eventStart:function(a){var b=this.data().f;if(!b.disabled&&!this.flip("isTurning")){b.corner=i._cornerActivated.call(this,a);if(b.corner&&i._foldingPage.call(this,b.corner))return i._showFoldedPage.call(this,b.corner)&&this.trigger("pressed",[b.point]),!1;b.corner=null}},_eventMove:function(a){var b=this.data().f;if(!b.disabled)if(a=t?a.originalEvent.touches:[a],b.corner){var c=b.parent.offset();b.corner.x=a[0].pageX-c.left;b.corner.y=a[0].pageY-c.top;i._showFoldedPage.call(this,b.corner)}else!this.data().effect&&
this.is(":visible")&&((a=i._cornerActivated.call(this,a[0]))?(b=i._c.call(this,a.corner,b.opts.cornerSize/2),a.x=b.x,a.y=b.y,i._showFoldedPage.call(this,a,!0)):i.hideFoldedPage.call(this,!0))},_eventEnd:function(){var a=this.data().f;if(!a.disabled&&a.point){var b=g.Event("released");this.trigger(b,[a.point]);b.isDefaultPrevented()||i.hideFoldedPage.call(this,!0)}a.corner=null},disable:function(a){i.setData.call(this,{disabled:a});return this}};window.requestAnim=function(){return window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();g.extend(g.fn,{flip:function(a,b){return O(g(this[0]),i,arguments)},turn:function(a){return O(g(this[0]),h,arguments)},transform:function(a,b){var c={};b&&(c[w+"transform-origin"]=b);c[w+"transform"]=a;return this.css(c)},animatef:function(a){var b=this.data();b.effect&&b.effect.stop();if(a){a.to.length||(a.to=[a.to]);a.from.length||
(a.from=[a.from]);for(var c=[],d=a.to.length,e=!0,f=this,h=(new Date).getTime(),i=function(){if(b.effect&&e){for(var g=[],j=Math.min(a.duration,(new Date).getTime()-h),k=0;k<d;k++)g.push(b.effect.easing(1,j,a.from[k],c[k],a.duration));a.frame(1==d?g[0]:g);j==a.duration?(delete b.effect,f.data(b),a.complete&&a.complete()):requestAnim(i)}},j=0;j<d;j++)c.push(a.to[j]-a.from[j]);b.effect=g.extend({stop:function(){e=!1},easing:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c}},a);this.data(b);i()}else delete b.effect}});
g.isTouch=t;g.mouseEvents=q;g.cssPrefix=R})(jQuery);

/* turn.js 4.0.9 | Copyright (c) 2012 Emmanuel Garcia | turnjs.com | turnjs.com/license.txt */

(function(g){function P(a,b,c){if(!c[0]||"object"==typeof c[0])return b.init.apply(a,c);if(b[c[0]])return b[c[0]].apply(a,Array.prototype.slice.call(c,1));throw p(c[0]+" is not a method or property");}function l(a,b,c,d){return{css:{position:"absolute",top:a,left:b,overflow:d||"hidden",zIndex:c||"auto"}}}function Q(a,b,c,d,e){var f=1-e,k=f*f*f,g=e*e*e;return j(Math.round(k*a.x+3*e*f*f*b.x+3*e*e*f*c.x+g*d.x),Math.round(k*a.y+3*e*f*f*b.y+3*e*e*f*c.y+g*d.y))}function j(a,b){return{x:a,y:b}}function r(a,
b,c){return C&&c?" translate3d("+a+"px,"+b+"px, 0px) ":" translate("+a+"px, "+b+"px) "}function s(a){return" rotate("+a+"deg) "}function n(a,b){return Object.prototype.hasOwnProperty.call(b,a)}function R(){for(var a=["Moz","Webkit","Khtml","O","ms"],b=a.length,c="";b--;)a[b]+"Transform"in document.body.style&&(c="-"+a[b].toLowerCase()+"-");return c}function N(a,b,c,d,e){var f,k=[];if("-webkit-"==z){for(f=0;f<e;f++)k.push("color-stop("+d[f][0]+", "+d[f][1]+")");a.css({"background-image":"-webkit-gradient(linear, "+
b.x+"% "+b.y+"%,"+c.x+"% "+c.y+"%, "+k.join(",")+" )"})}else{var b={x:b.x/100*a.width(),y:b.y/100*a.height()},c={x:c.x/100*a.width(),y:c.y/100*a.height()},g=c.x-b.x;f=c.y-b.y;var i=Math.atan2(f,g),h=i-Math.PI/2,h=Math.abs(a.width()*Math.sin(h))+Math.abs(a.height()*Math.cos(h)),g=Math.sqrt(f*f+g*g),c=j(c.x<b.x?a.width():0,c.y<b.y?a.height():0),o=Math.tan(i);f=-1/o;o=(f*c.x-c.y-o*b.x+b.y)/(f-o);c=f*o-f*c.x+c.y;b=Math.sqrt(Math.pow(o-b.x,2)+Math.pow(c-b.y,2));for(f=0;f<e;f++)k.push(" "+d[f][1]+" "+100*
(b+g*d[f][0])/h+"%");a.css({"background-image":z+"linear-gradient("+-i+"rad,"+k.join(",")+")"})}}function v(a,b,c){a=g.Event(a);b.trigger(a,c);return a.isDefaultPrevented()?"prevented":a.isPropagationStopped()?"stopped":""}function p(a){function b(a){this.name="TurnJsError";this.message=a}b.prototype=Error();b.prototype.constructor=b;return new b(a)}function D(a){var b={top:0,left:0};do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent);return b}var C,z="",K=Math.PI,I=K/2,w="ontouchstart"in
window,t=w?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},q={backward:["bl","tl","l"],forward:["br","tr","r"],all:"tl bl tr br l r".split(" ")},S=["single","double"],T=["ltr","rtl"],U={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,turnCorners:"bl,br",when:null},V={acceleration:!0,cornerSize:100,duration:600,gradients:!0},h={init:function(a){C="WebKitCSSMatrix"in
window||"MozPerspective"in document.body.style;z=R();var b,c=this,d=0,e=this.data(),f=this.children(),a=g.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},U,a);e.opts=a;e.pageObjs={};e.pages={};e.pageWrap={};e.pagePlace={};e.pageMv=[];e.zoom=1;e.totalPages=a.pages||0;e.eventHandlers={mouseStart:function(){for(var a in e.pages)if(n(a,e.pages)&&!1===i._eventStart.apply(e.pages[a],arguments))return!1},mouseMove:function(){for(var a in e.pages)n(a,
e.pages)&&i._eventMove.apply(e.pages[a],arguments)},mouseEnd:function(){for(var a in e.pages)n(a,e.pages)&&i._eventEnd.apply(e.pages[a],arguments)},start:function(){return h._start.apply(c,arguments)}};if(a.when)for(b in a.when)n(b,a.when)&&this.bind(b,a.when[b]);this.css({position:"relative",width:a.width,height:a.height});this.turn("display",a.display);""!==a.direction&&this.turn("direction",a.direction);C&&(!w&&a.acceleration)&&this.transform(r(0,0,!0));for(b=0;b<f.length;b++)"1"!=g(f[b]).attr("ignore")&&
this.turn("addPage",f[b],++d);g(this).bind(t.down,e.eventHandlers.mouseStart).bind("end",h._end).bind("pressed",h._pressed).bind("released",h._released).bind("flip",h._flip);g(this).parent().bind("start",e.eventHandlers.start);g(document).bind(t.move,e.eventHandlers.mouseMove).bind(t.up,e.eventHandlers.mouseEnd);this.turn("page",a.page);e.done=!0;return this},addPage:function(a,b){var c,d=!1,e=this.data(),f=e.totalPages+1;if(e.destroying)return!1;if(c=/\bp([0-9]+)\b/.exec(g(a).attr("class")))b=parseInt(c[1],
10);if(b)if(b==f)d=!0;else{if(b>f)throw p('Page "'+b+'" cannot be inserted');}else b=f,d=!0;1<=b&&b<=f&&(c="double"==e.display?b%2?" odd":" even":"",e.done&&this.turn("stop"),b in e.pageObjs&&h._movePages.call(this,b,1),d&&(e.totalPages=f),e.pageObjs[b]=g(a).css({"float":"left"}).addClass("page p"+b+c),h._addPage.call(this,b),h._removeFromDOM.call(this));return this},_addPage:function(a){var b=this.data(),c=b.pageObjs[a];if(c)if(h._necessPage.call(this,a)){if(!b.pageWrap[a]){b.pagePlace[a]=a;b.pageWrap[a]=
g("<div/>",{"class":"page-wrapper",page:a,css:{position:"absolute",overflow:"hidden"}});this.append(b.pageWrap[a]);b.pageObjs[a].appendTo(b.pageWrap[a]);var d=h._pageSize.call(this,a,!0);c.css({width:d.width,height:d.height});b.pageWrap[a].css(d)}h._makeFlip.call(this,a)}else b.pagePlace[a]=0,b.pageObjs[a]&&b.pageObjs[a].remove()},hasPage:function(a){return n(a,this.data().pageObjs)},center:function(a){var b=this.data(),c=g(this).turn("size"),d=c.width/(2*b.zoom)-c.width/2;b.noCenter||("double"==
b.display&&(a=this.turn("view",a||b.tpage||b.page),"ltr"==b.direction?a[0]?a[1]||(d+=c.width/4):d-=c.width/4:a[0]?a[1]||(d-=c.width/4):d+=c.width/4),g(this).css({marginLeft:d}));return this},destroy:function(){var a=this,b=this.data(),c="end first flip last pressed released start turning turned zooming missing".split(" ");if("prevented"!=v("destroying",this)){b.destroying=!0;g.each(c,function(b,c){a.unbind(c)});this.parent().unbind("start",b.eventHandlers.start);for(g(document).unbind(t.move,b.eventHandlers.mouseMove).unbind(t.up,
b.eventHandlers.mouseEnd);0!==b.totalPages;)this.turn("removePage",b.totalPages);b.fparent&&b.fparent.remove();b.shadow&&b.shadow.remove();this.removeData();b=null;return this}},is:function(){return"object"==typeof this.data().pages},zoom:function(a){var b=this.data();if("number"==typeof a){if(0.0010>a||100<a)throw p(a+" is not a value for zoom");if("prevented"==v("zooming",this,[a,b.zoom]))return this;var c=g(this).turn("size"),d=1/b.zoom,e=Math.round(c.width*d*a),f=Math.round(c.height*d*a);b.zoom=
a;g(this).turn("stop").turn("size",e,f).css({marginTop:c.height*d/2-f/2});b.opts.autoCenter?this.turn("center"):g(this).css({marginLeft:c.width*d/2-e/2});h._updateShadow.call(this);return this}return b.zoom},_pageSize:function(a,b){var c=this.data(),d={};if("single"==c.display)d.width=this.width(),d.height=this.height(),b&&(d.top=0,d.left=0,d.right="auto");else{var e=this.width()/2,f=this.height();c.pageObjs[a].hasClass("own-size")?(d.width=c.pageObjs[a].width(),d.height=c.pageObjs[a].height()):(d.width=
e,d.height=f);if(b){var g=a%2;d.top=(f-d.height)/2;"ltr"==c.direction?(d[g?"right":"left"]=e-d.width,d[g?"left":"right"]="auto"):(d[g?"left":"right"]=e-d.width,d[g?"right":"left"]="auto")}}return d},_makeFlip:function(a){var b=this.data();if(!b.pages[a]&&b.pagePlace[a]==a){var c="single"==b.display,d=a%2;b.pages[a]=b.pageObjs[a].css(h._pageSize.call(this,a)).flip({page:a,next:d||c?a+1:a-1,turn:this,duration:b.opts.duration,acceleration:b.opts.acceleration,gradients:b.opts.gradients}).flip("disable",
b.disabled);h._setPageLoc.call(this,a)}return b.pages[a]},_makeRange:function(){var a,b;if(!(1>this.data().totalPages)){b=this.turn("range");for(a=b[0];a<=b[1];a++)h._addPage.call(this,a)}},range:function(a){var b,c,d,e=this.data(),a=a||e.tpage||e.page||1;d=h._view.call(this,a);if(1>a||a>e.totalPages)throw p('"'+a+'" is not a page for range');d[1]=d[1]||d[0];1<=d[0]&&d[1]<=e.totalPages?(a=Math.floor(2),e.totalPages-d[1]>d[0]?(b=Math.min(d[0]-1,a),c=2*a-b):(c=Math.min(e.totalPages-d[1],a),b=2*a-c)):
c=b=5;return[Math.max(1,d[0]-b),Math.min(e.totalPages,d[1]+c)]},_necessPage:function(a){if(0===a)return!0;var b=this.turn("range");return this.data().pageObjs[a].hasClass("fixed")||a>=b[0]&&a<=b[1]},_removeFromDOM:function(){var a,b=this.data();for(a in b.pageWrap)n(a,b.pageWrap)&&!h._necessPage.call(this,a)&&h._removePageFromDOM.call(this,a)},_removePageFromDOM:function(a){var b=this.data();if(b.pages[a]){var c=b.pages[a].data();i._moveFoldingPage.call(b.pages[a],!1);c.f&&c.f.fwrapper&&c.f.fwrapper.remove();
b.pages[a].removeData();b.pages[a].remove();delete b.pages[a]}b.pageObjs[a]&&b.pageObjs[a].remove();b.pageWrap[a]&&(b.pageWrap[a].remove(),delete b.pageWrap[a]);h._removeMv.call(this,a);delete b.pagePlace[a]},removePage:function(a){var b=this.data();if(1>a||a>b.totalPages)throw p("The page "+a+" doesn't exist");b.pageObjs[a]&&(this.turn("stop"),h._removePageFromDOM.call(this,a),delete b.pageObjs[a]);h._movePages.call(this,a,-1);b.totalPages-=1;b.page>b.totalPages?this.turn("page",b.totalPages):h._makeRange.call(this);
return this},_movePages:function(a,b){var c,d=this,e=this.data(),f="single"==e.display,g=function(a){var c=a+b,g=c%2,k=g?" odd ":" even ";e.pageObjs[a]&&(e.pageObjs[c]=e.pageObjs[a].removeClass("p"+a+" odd even").addClass("p"+c+k));e.pagePlace[a]&&e.pageWrap[a]&&(e.pagePlace[c]=c,e.pageWrap[c]=e.pageObjs[c].hasClass("fixed")?e.pageWrap[a].attr("page",c):e.pageWrap[a].css(h._pageSize.call(d,c,!0)).attr("page",c),e.pages[a]&&(e.pages[c]=e.pages[a].flip("options",{page:c,next:f||g?c+1:c-1})),b&&(delete e.pages[a],
delete e.pagePlace[a],delete e.pageObjs[a],delete e.pageWrap[a],delete e.pageObjs[a]))};if(0<b)for(c=e.totalPages;c>=a;c--)g(c);else for(c=a;c<=e.totalPages;c++)g(c)},display:function(a){var b=this.data(),c=b.display;if(void 0===a)return c;if(-1==g.inArray(a,S))throw p('"'+a+'" is not a value for display');switch(a){case "single":b.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),b.pageObjs[0]=g("<div />",{"class":"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this));
this.addClass("shadow");break;case "double":b.pageObjs[0]&&(this.turn("stop").css({overflow:""}),b.pageObjs[0].remove(),delete b.pageObjs[0]),this.removeClass("shadow")}b.display=a;c&&(a=this.turn("size"),h._movePages.call(this,1,0),this.turn("size",a.width,a.height).turn("update"));return this},direction:function(a){var b=this.data();if(void 0===a)return b.direction;a=a.toLowerCase();if(-1==g.inArray(a,T))throw p('"'+a+'" is not a value for direction');"rtl"==a&&g(this).attr("dir","ltr").css({direction:"ltr"});
b.direction=a;b.done&&this.turn("size",g(this).width(),g(this).height());return this},animating:function(){return 0<this.data().pageMv.length},corner:function(){var a,b,c=this.data();for(b in c.pages)if(n(b,c.pages)&&(a=c.pages[b].flip("corner")))return a;return!1},data:function(){return this.data()},disable:function(a){var b,c=this.data(),d=this.turn("view");c.disabled=void 0===a||!0===a;for(b in c.pages)n(b,c.pages)&&c.pages[b].flip("disable",c.disabled?!0:-1==g.inArray(parseInt(b,10),d));return this},
disabled:function(a){return void 0===a?!0===this.data().disabled:this.turn("disable",a)},size:function(a,b){if(void 0===a||void 0===b)return{width:this.width(),height:this.height()};this.turn("stop");var c,d,e=this.data();d="double"==e.display?a/2:a;this.css({width:a,height:b});e.pageObjs[0]&&e.pageObjs[0].css({width:d,height:b});for(c in e.pageWrap)n(c,e.pageWrap)&&(d=h._pageSize.call(this,c,!0),e.pageObjs[c].css({width:d.width,height:d.height}),e.pageWrap[c].css(d),e.pages[c]&&e.pages[c].css({width:d.width,
height:d.height}));this.turn("resize");return this},resize:function(){var a,b=this.data();b.pages[0]&&(b.pageWrap[0].css({left:-this.width()}),b.pages[0].flip("resize",!0));for(a=1;a<=b.totalPages;a++)b.pages[a]&&b.pages[a].flip("resize",!0);h._updateShadow.call(this);b.opts.autoCenter&&this.turn("center")},_removeMv:function(a){var b,c=this.data();for(b=0;b<c.pageMv.length;b++)if(c.pageMv[b]==a)return c.pageMv.splice(b,1),!0;return!1},_addMv:function(a){var b=this.data();h._removeMv.call(this,a);
b.pageMv.push(a)},_view:function(a){var b=this.data(),a=a||b.page;return"double"==b.display?a%2?[a-1,a]:[a,a+1]:[a]},view:function(a){var b=this.data(),a=h._view.call(this,a);return"double"==b.display?[0<a[0]?a[0]:0,a[1]<=b.totalPages?a[1]:0]:[0<a[0]&&a[0]<=b.totalPages?a[0]:0]},stop:function(a,b){if(this.turn("animating")){var c,d,e,f=this.data();f.tpage&&(f.page=f.tpage,delete f.tpage);for(c=0;c<f.pageMv.length;c++)f.pageMv[c]&&f.pageMv[c]!==a&&(e=f.pages[f.pageMv[c]],d=e.data().f.opts,e.flip("hideFoldedPage",
b),b||i._moveFoldingPage.call(e,!1),d.force&&(d.next=0===d.page%2?d.page-1:d.page+1,delete d.force))}this.turn("update");return this},pages:function(a){var b=this.data();if(a){if(a<b.totalPages)for(var c=b.totalPages;c>a;c--)this.turn("removePage",c);b.totalPages=a;h._fitPage.call(this,b.page);return this}return b.totalPages},_missing:function(a){for(var b=this.data(),c=this.turn("range",a),d=[],a=c[0];a<=c[1];a++)b.pageObjs[a]||d.push(a);0<d.length&&this.trigger("missing",[d])},_fitPage:function(a){var b=
this.data(),c=this.turn("view",a);h._missing.call(this,a);b.pageObjs[a]&&(b.page=a,this.turn("stop"),h._removeFromDOM.call(this),h._makeRange.call(this),h._updateShadow.call(this),this.trigger("turned",[a,c]),this.turn("update"),b.opts.autoCenter&&this.turn("center"))},_turnPage:function(a,b){var c,d,e=this.data(),f=e.pagePlace[a],k=this.turn("view"),i=this.turn("view",a);if(e.page!=a){var j=e.page;if("prevented"==v("turning",this,[a,i])){j==e.page&&-1!=g.inArray(f,e.pageMv)&&e.pages[f].flip("hideFoldedPage",
!0);return}-1!=g.inArray(1,i)&&this.trigger("first");-1!=g.inArray(e.totalPages,i)&&this.trigger("last")}if(b)this.turn("stop",f);else{h._missing.call(this,a);if(!e.pageObjs[a])return;this.turn("stop");e.page=a}h._makeRange.call(this);"single"==e.display?(c=k[0],d=i[0]):k[1]&&a>k[1]?(c=k[1],d=i[0]):k[0]&&a<k[0]&&(c=k[0],d=i[1]);e.pages[c]&&(f=e.pages[c].data().f,k=f.opts,i=e.opts.turnCorners.split(","),e.tpage=d,k.next!=d&&(k.next=d,k.force=!0),this.turn("update"),"hard"==f.effect?"ltr"==e.direction?
e.pages[c].flip("turnPage",a>c?"r":"l"):e.pages[c].flip("turnPage",a>c?"l":"r"):"ltr"==e.direction?e.pages[c].flip("turnPage",i[a>c?1:0]):e.pages[c].flip("turnPage",i[a>c?0:1]))},page:function(a){var b=this.data();if(void 0===a)return b.page;if(!b.disabled&&!b.destroying){a=parseInt(a,10);if(0<a&&a<=b.totalPages)return a!=b.page&&(!b.done||-1!=g.inArray(a,this.turn("view"))?h._fitPage.call(this,a):h._turnPage.call(this,a)),this;throw p("The page "+a+" doesn't exist");}},next:function(){return this.turn("page",
Math.min(this.data().totalPages,h._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,h._view.call(this,this.data().page).shift()-1))},peel:function(a,b){var c=this.data(),d=this.turn("view"),b=void 0===b?!0:!0===b;if(!1===a)this.turn("stop",null,b);else if("single"==c.display)c.pages[c.page].flip("peel",a,b);else if(d="ltr"==c.direction?-1!=a.indexOf("l")?d[0]:d[1]:-1!=a.indexOf("l")?d[1]:d[0],c.pages[d])c.pages[d].flip("peel",a,b);else throw p("Unexpected corner "+
a);return this},_addMotionPage:function(){var a=g(this).data().f.opts,b=a.turn;b.data();h._addMv.call(b,a.page)},_start:function(a,b,c){var d=b.turn.data();a.isDefaultPrevented()||("single"==d.display&&c&&("l"==c.charAt(1)&&"ltr"==d.direction||"r"==c.charAt(1)&&"rtl"==d.direction?(b.next=b.next<b.page?b.next:b.page-1,b.force=!0):b.next=b.next>b.page?b.next:b.page+1),h._addMotionPage.call(a.target));h._updateShadow.call(b.turn)},_end:function(a,b,c){g(a.target).data();var a=b.turn,d=a.data();if(c){if(c=
d.tpage||d.page,c==b.next||c==b.page)delete d.tpage,h._fitPage.call(a,c||b.next,!0)}else h._removeMv.call(a,b.page),h._updateShadow.call(a),a.turn("update")},_pressed:function(a){var a=g(a.target).data().f,b=a.opts.turn;b.data().mouseAction=!0;b.turn("update");return a.time=(new Date).getTime()},_released:function(a,b){var c,d=g(a.target),e=d.data().f,f=e.opts.turn,k=f.data();c="single"==k.display?"br"==b.corner||"tr"==b.corner?b.x<d.width()/2:b.x>d.width()/2:0>b.x||b.x>d.width();if(200>(new Date).getTime()-
e.time||c)a.preventDefault(),h._turnPage.call(f,e.opts.next,!1===i._cornerActivated.call(d,b,1));k.mouseAction=!1},_flip:function(a){a.stopPropagation();a=g(a.target).data().f.opts;a.turn.trigger("turn",[a.next]);a.turn.data().opts.autoCenter&&a.turn.turn("center",a.next)},calculateZ:function(a){var b,c,d,e,f=this,g=this.data();b=this.turn("view");var i=b[0]||b[1],h=a.length-1,j={pageZ:{},partZ:{},pageV:{}},o=function(a){a=f.turn("view",a);a[0]&&(j.pageV[a[0]]=!0);a[1]&&(j.pageV[a[1]]=!0)};for(b=
0;b<=h;b++)c=a[b],d=g.pages[c].data().f.opts.next,e=g.pagePlace[c],o(c),o(d),c=g.pagePlace[d]==d?d:c,j.pageZ[c]=g.totalPages-Math.abs(i-c),j.partZ[e]=2*g.totalPages-h+b;return j},update:function(){var a,b=this.data();if(this.turn("animating")&&0!==b.pageMv[0]){var c,d=this.turn("calculateZ",b.pageMv),e=this.turn("corner"),f=this.turn("view"),i=this.turn("view",b.tpage);for(a in b.pageWrap)if(n(a,b.pageWrap)&&(c=b.pageObjs[a].hasClass("fixed"),b.pageWrap[a].css({display:d.pageV[a]||c?"":"none",zIndex:(b.pageObjs[a].hasClass("hard")?
d.partZ[a]:d.pageZ[a])||(c?-1:0)}),c=b.pages[a]))c.flip("z",d.partZ[a]||null),d.pageV[a]&&c.flip("resize"),b.tpage?c.flip("hover",!1).flip("disable",-1==g.inArray(parseInt(a,10),b.pageMv)&&a!=i[0]&&a!=i[1]):c.flip("hover",!1===e).flip("disable",a!=f[0]&&a!=f[1])}else for(a in b.pageWrap)n(a,b.pageWrap)&&(d=h._setPageLoc.call(this,a),b.pages[a]&&b.pages[a].flip("disable",b.disabled||1!=d).flip("hover",!0).flip("z",null));return this},_updateShadow:function(){var a,b,c=this.data(),d=this.width(),e=
this.height(),f="single"==c.display?d:d/2;a=this.turn("view");c.shadow||(c.shadow=g("<div />",{"class":"shadow",css:l(0,0,0).css}).appendTo(this));for(var i=0;i<c.pageMv.length&&a[0]&&a[1];i++)a=this.turn("view",c.pages[c.pageMv[i]].data().f.opts.next),b=this.turn("view",c.pageMv[i]),a[0]=a[0]&&b[0],a[1]=a[1]&&b[1];switch(a[0]?a[1]?3:"ltr"==c.direction?2:1:"ltr"==c.direction?1:2){case 1:c.shadow.css({width:f,height:e,top:0,left:f});break;case 2:c.shadow.css({width:f,height:e,top:0,left:0});break;
case 3:c.shadow.css({width:d,height:e,top:0,left:0})}},_setPageLoc:function(a){var b=this.data(),c=this.turn("view"),d=0;if(a==c[0]||a==c[1])d=1;else if("single"==b.display&&a==c[0]+1||"double"==b.display&&a==c[0]-2||a==c[1]+2)d=2;if(!this.turn("animating"))switch(d){case 1:b.pageWrap[a].css({zIndex:b.totalPages,display:""});break;case 2:b.pageWrap[a].css({zIndex:b.totalPages-1,display:""});break;case 0:b.pageWrap[a].css({zIndex:0,display:b.pageObjs[a].hasClass("fixed")?"":"none"})}return d},options:function(){return this.data().opts},
version:function(){return"4.0.9"}},i={init:function(a){this.data({f:{disabled:!1,hover:!1,effect:this.hasClass("hard")?"hard":"sheet"}});this.flip("options",a);i._addPageWrapper.call(this);return this},setData:function(a){var b=this.data();b.f=g.extend(b.f,a);return this},options:function(a){var b=this.data().f;return a?(i.setData.call(this,{opts:g.extend({},b.opts||V,a)}),this):b.opts},z:function(a){var b=this.data().f;b.opts["z-index"]=a;b.fwrapper&&b.fwrapper.css({zIndex:a||parseInt(b.parent.css("z-index"),
10)||0});return this},_cAllowed:function(){var a=this.data().f,b=a.opts.page,c=a.opts.turn.data(),d=b%2;return"hard"==a.effect?"ltr"==c.direction?[d?"r":"l"]:[d?"l":"r"]:"single"==c.display?1==b?"ltr"==c.direction?q.forward:q.backward:b==c.totalPages?"ltr"==c.direction?q.backward:q.forward:q.all:"ltr"==c.direction?q[d?"forward":"backward"]:q[d?"backward":"forward"]},_cornerActivated:function(a){var b=this.data().f,c=this.width(),d=this.height(),a={x:a.x,y:a.y},e=b.opts.cornerSize;if(0>=a.x||0>=a.y||
a.x>=c||a.y>=d)return!1;var f=i._cAllowed.call(this);switch(b.effect){case "hard":if(a.x>c-e)a.corner="r";else if(a.x<e)a.corner="l";else return!1;break;case "sheet":if(a.y<e)a.corner="t";else if(a.y>=d-e)a.corner="b";else return!1;if(a.x<=e)a.corner+="l";else if(a.x>=c-e)a.corner+="r";else return!1}return-1==g.inArray(a.corner,f)?!1:a},_isIArea:function(a){var b=this.data().f.parent.offset(),a=w&&a.originalEvent?a.originalEvent.touches[0]:a;return i._cornerActivated.call(this,{x:a.pageX-b.left,y:a.pageY-
b.top})},_c:function(a,b){b=b||0;switch(a){case "tl":return j(b,b);case "tr":return j(this.width()-b,b);case "bl":return j(b,this.height()-b);case "br":return j(this.width()-b,this.height()-b);case "l":return j(b,0);case "r":return j(this.width()-b,0)}},_c2:function(a){switch(a){case "tl":return j(2*this.width(),0);case "tr":return j(-this.width(),0);case "bl":return j(2*this.width(),this.height());case "br":return j(-this.width(),this.height());case "l":return j(2*this.width(),0);case "r":return j(-this.width(),
0)}},_foldingPage:function(){var a=this.data().f;if(a){var b=a.opts;if(b.turn)return a=b.turn.data(),"single"==a.display?a.pageObjs[b.next]?a.pageObjs[0]:null:a.pageObjs[b.next]}},_backGradient:function(){var a=this.data().f,b=a.opts.turn;if((b=a.opts.gradients&&(!b||"single"==b.data().display||2!=a.opts.page&&a.opts.page!=b.data().totalPages-1))&&!a.bshadow)a.bshadow=g("<div/>",l(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(a.parent);return b},type:function(){return this.data().f.effect},
resize:function(a){var b=this.data().f,c=this.width(),d=this.height();switch(b.effect){case "hard":a&&(b.wrapper.css({width:c,height:d}),b.fpage.css({width:c,height:d}),b.opts.gradients&&(b.ashadow.css({width:c,height:d}),b.bshadow.css({width:c,height:d})));break;case "sheet":a&&(a=Math.round(Math.sqrt(Math.pow(c,2)+Math.pow(d,2))),b.wrapper.css({width:a,height:a}),b.fwrapper.css({width:a,height:a}).children(":first-child").css({width:c,height:d}),b.fpage.css({width:d,height:c}),b.opts.gradients&&
b.ashadow.css({width:d,height:c}),i._backGradient.call(this)&&b.bshadow.css({width:c,height:d})),b.parent.is(":visible")&&(c=D(b.parent[0]),b.fwrapper.css({top:c.top,left:c.left}),b.opts.turn&&(c=D(b.opts.turn[0]),b.fparent.css({top:-c.top,left:-c.left}))),this.flip("z",b.opts["z-index"])}},_addPageWrapper:function(){var a=this.data().f,b=this.parent();a.parent=b;if(!a.wrapper)switch(a.effect){case "hard":var c={};c[z+"transform-style"]="preserve-3d";c[z+"backface-visibility"]="hidden";a.wrapper=
g("<div/>",l(0,0,2)).css(c).appendTo(b).prepend(this);a.fpage=g("<div/>",l(0,0,1)).css(c).appendTo(b);a.opts.gradients&&(a.ashadow=g("<div/>",l(0,0,0)).hide().appendTo(b),a.bshadow=g("<div/>",l(0,0,0)));break;case "sheet":var c=this.width(),d=this.height();Math.round(Math.sqrt(Math.pow(c,2)+Math.pow(d,2)));a.fparent=a.opts.turn.data().fparent;a.fparent||(c=g("<div/>",{css:{"pointer-events":"none"}}).hide(),c.data().flips=0,c.css(l(0,0,"auto","visible").css).appendTo(a.opts.turn),a.opts.turn.data().fparent=
c,a.fparent=c);this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"});a.wrapper=g("<div/>",l(0,0,this.css("z-index"))).appendTo(b).prepend(this);a.fwrapper=g("<div/>",l(b.offset().top,b.offset().left)).hide().appendTo(a.fparent);a.fpage=g("<div/>",{css:{cursor:"default"}}).appendTo(g("<div/>",l(0,0,0,"visible")).appendTo(a.fwrapper));a.opts.gradients&&(a.ashadow=g("<div/>",l(0,0,1)).appendTo(a.fpage));i.setData.call(this,a)}i.resize.call(this,!0)},_fold:function(a){var b=this.data().f,
c=i._c.call(this,a.corner),d=this.width(),e=this.height();switch(b.effect){case "hard":a.x="l"==a.corner?Math.min(Math.max(a.x,0),2*d):Math.max(Math.min(a.x,d),-d);var f,g,h,O,l,o=b.opts.turn.data().totalPages,n=b.opts["z-index"]||o,p={overflow:"visible"},E=c.x?(c.x-a.x)/d:a.x/d,q=90*E,t=90>q;switch(a.corner){case "l":O="0% 50%";l="100% 50%";t?(f=0,g=0<b.opts.next-1,h=1):(f="100%",g=b.opts.page+1<o,h=0);break;case "r":O="100% 50%",l="0% 50%",q=-q,d=-d,t?(f=0,g=b.opts.next+1<o,h=0):(f="-100%",g=1!=
b.opts.page,h=1)}p[z+"perspective-origin"]=l;b.wrapper.transform("rotateY("+q+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",l);b.fpage.transform("translateX("+d+"px) rotateY("+(180+q)+"deg)",O);b.parent.css(p);t?(E=-E+1,b.wrapper.css({zIndex:n+1}),b.fpage.css({zIndex:n})):(E-=1,b.wrapper.css({zIndex:n}),b.fpage.css({zIndex:n+1}));b.opts.gradients&&(g?b.ashadow.css({display:"",left:f,backgroundColor:"rgba(0,0,0,"+0.5*E+")"}).transform("rotateY(0deg)"):b.ashadow.hide(),b.bshadow.css({opacity:-E+
1}),t?b.bshadow.parent()[0]!=b.wrapper[0]&&b.bshadow.appendTo(b.wrapper):b.bshadow.parent()[0]!=b.fpage[0]&&b.bshadow.appendTo(b.fpage),N(b.bshadow,j(100*h,0),j(100*(-h+1),0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2));break;case "sheet":var v=this,x=0,w,F,G,L,A,M,y=j(0,0),C=j(0,0),m=j(0,0);f=i._foldingPage.call(this);Math.tan(0);var u=b.opts.acceleration,D=b.wrapper.height(),H="t"==a.corner.substr(0,1),B="l"==a.corner.substr(1,1),J=function(){var f=j(c.x?c.x-a.x:a.x,c.y?c.y-a.y:a.y),g=j(B?d-
f.x/2:a.x+f.x/2,f.y/2),h=2>f.x&&2>f.y?I/2:I-Math.atan2(f.y,f.x),k=h-Math.atan2(g.y,g.x),k=Math.max(0,Math.sin(k)*Math.sqrt(Math.pow(g.x,2)+Math.pow(g.y,2)));x=180*(h/K);m=j(k*Math.sin(h),k*Math.cos(h));if(h>I&&(m.x+=Math.abs(m.y*f.y/f.x),m.y=0,Math.round(m.x*Math.tan(K-h))<e))return a.y=Math.sqrt(Math.pow(e,2)+2*g.x*f.x),H&&(a.y=e-a.y),J();if(h>I&&(f=K-h,g=D-e/Math.sin(f),y=j(Math.round(g*Math.cos(f)),Math.round(g*Math.sin(f))),B&&(y.x=-y.x),H))y.y=-y.y;w=Math.round(m.y/Math.tan(h)+m.x);f=d-w;g=f*
Math.cos(2*h);k=f*Math.sin(2*h);C=j(Math.round(B?f-g:w+g),Math.round(H?k:e-k));A=f*Math.sin(h);f=i._c2.call(v,a.corner);f=Math.sqrt(Math.pow(f.x-a.x,2)+Math.pow(f.y-a.y,2));M=f<d?f/d:1;if(b.opts.gradients&&(L=100<A?(A-100)/A:0,F=j(100*(A*Math.sin(I-h)/e),100*(A*Math.cos(I-h)/d)),H&&(F.y=100-F.y),B))F.x=100-F.x;if(i._backGradient.call(v)&&(G=j(100*(1.2*A*Math.sin(h)/d),100*(1.2*A*Math.cos(h)/e)),B||(G.x=100-G.x),!H))G.y=100-G.y;m.x=Math.round(m.x);m.y=Math.round(m.y);return!0};g=function(a,c,f,g){var h=
["0","auto"],k=(d-D)*f[0]/100,o=(e-D)*f[1]/100,c={left:h[c[0]],top:h[c[1]],right:h[c[2]],bottom:h[c[3]]},h=90!=g&&-90!=g?B?-1:1:0,f=f[0]+"% "+f[1]+"%";v.css(c).transform(s(g)+r(a.x+h,a.y,u),f);b.fpage.parent().css(c);b.wrapper.transform(r(-a.x+k-h,-a.y+o,u)+s(-g),f);b.fwrapper.transform(r(-a.x+y.x+k,-a.y+y.y+o,u)+s(-g),f);b.fpage.parent().transform(s(g)+r(a.x+C.x-y.x,a.y+C.y-y.y,u),f);b.opts.gradients&&N(b.ashadow,j(B?100:0,H?100:0),j(F.x,F.y),[[L,"rgba(0,0,0,0)"],[0.8*(1-L)+L,"rgba(0,0,0,"+0.2*M+
")"],[1,"rgba(255,255,255,"+0.2*M+")"]],3,0);i._backGradient.call(v)&&N(b.bshadow,j(B?0:100,H?0:100),j(G.x,G.y),[[0.6,"rgba(0,0,0,0)"],[0.8,"rgba(0,0,0,"+0.3*M+")"],[1,"rgba(0,0,0,0)"]],3)};switch(a.corner){case "tl":a.x=Math.max(a.x,1);J();g(m,[1,0,0,1],[100,0],x);b.fpage.transform(r(-e,-d,u)+s(90-2*x),"100% 100%");f.transform(s(90)+r(0,-e,u),"0% 0%");break;case "tr":a.x=Math.min(a.x,d-1);J();g(j(-m.x,m.y),[0,0,0,1],[0,0],-x);b.fpage.transform(r(0,-d,u)+s(-90+2*x),"0% 100%");f.transform(s(270)+r(-d,
0,u),"0% 0%");break;case "bl":a.x=Math.max(a.x,1);J();g(j(m.x,-m.y),[1,1,0,0],[100,100],-x);b.fpage.transform(r(-e,0,u)+s(-90+2*x),"100% 0%");f.transform(s(270)+r(-d,0,u),"0% 0%");break;case "br":a.x=Math.min(a.x,d-1),J(),g(j(-m.x,-m.y),[0,1,1,0],[0,100],x),b.fpage.transform(s(90-2*x),"0% 0%"),f.transform(s(90)+r(0,-e,u),"0% 0%")}}b.point=a},_moveFoldingPage:function(a){var b=this.data().f;if(b){var c=b.opts.turn,d=c.data(),e=d.pagePlace;a?(d=b.opts.next,e[d]!=b.opts.page&&(b.folding&&i._moveFoldingPage.call(this,
!1),i._foldingPage.call(this).appendTo(b.fpage),e[d]=b.opts.page,b.folding=d),c.turn("update")):b.folding&&(d.pages[b.folding]?(c=d.pages[b.folding].data().f,d.pageObjs[b.folding].appendTo(c.wrapper)):d.pageWrap[b.folding]&&d.pageObjs[b.folding].appendTo(d.pageWrap[b.folding]),b.folding in e&&(e[b.folding]=b.folding),delete b.folding)}},_showFoldedPage:function(a,b){var c=i._foldingPage.call(this),d=this.data(),e=d.f,f=e.visible;if(e){if(!f||!e.point||e.point.corner!=a.corner){var g=e.opts.turn.data().mouseAction,
f=!1;if("prevented"==v("start",this,[e.opts,"hover"==e.status||g?a.corner:null]))return!1}if(c){if(b){var h=this,c=e.point&&e.point.corner==a.corner?e.point:i._c.call(this,a.corner,1);this.animatef({from:[c.x,c.y],to:[a.x,a.y],duration:500,frame:function(b){a.x=Math.round(b[0]);a.y=Math.round(b[1]);i._fold.call(h,a)}})}else i._fold.call(this,a),d.effect&&!d.effect.turning&&this.animatef(!1);if(!f)switch(e.effect){case "hard":e.visible=!0;i._moveFoldingPage.call(this,!0);e.fpage.show();e.opts.shadows&&
e.bshadow.show();break;case "sheet":e.visible=!0,e.fparent.show().data().flips++,i._moveFoldingPage.call(this,!0),e.fwrapper.show(),e.bshadow&&e.bshadow.show()}return!0}return!1}},hide:function(){var a=this.data().f,b=i._foldingPage.call(this);switch(a.effect){case "hard":a.opts.gradients&&(a.bshadowLoc=0,a.bshadow.remove(),a.ashadow.hide());a.wrapper.transform("");a.fpage.hide();break;case "sheet":0===--a.fparent.data().flips&&a.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform(""),
a.wrapper.transform(""),a.fwrapper.hide(),a.bshadow&&a.bshadow.hide(),b.transform("")}a.visible=!1;return this},hideFoldedPage:function(a){var b=this.data().f;if(b.point){var c=this,d=b.point,e=function(){b.point=null;b.status="";c.flip("hide");c.trigger("end",[b.opts,!1])};if(a){var f=i._c.call(this,d.corner),a="t"==d.corner.substr(0,1)?Math.min(0,d.y-f.y)/2:Math.max(0,d.y-f.y)/2,g=j(d.x,d.y+a),h=j(f.x,f.y-a);this.animatef({from:0,to:1,frame:function(a){a=Q(d,g,h,f,a);d.x=a.x;d.y=a.y;i._fold.call(c,
d)},complete:e,duration:800,hiding:!0})}else this.animatef(!1),e()}},turnPage:function(a){var b=this,c=this.data().f,a={corner:c.corner?c.corner.corner:a||i._cAllowed.call(this)[0]},d=c.point||i._c.call(this,a.corner,c.opts.turn?c.opts.turn.data().opts.elevation:0),e=i._c2.call(this,a.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(c){c=Q(d,d,e,e,c);a.x=c.x;a.y=c.y;i._showFoldedPage.call(b,a)},complete:function(){b.trigger("end",[c.opts,!0])},duration:c.opts.duration,turning:!0});
c.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(a){var b=this.data().f,c=b.opts.turn;if(!b.disabled&&!this.flip("isTurning")&&b.opts.page==c.data().pagePlace[b.opts.page]){b.corner=i._isIArea.call(this,a);if(b.corner)return this.trigger("pressed",[b.point]),i._showFoldedPage.call(this,b.corner),!1;b.corner=null}},_eventMove:function(a){var b=
this.data().f;if(!b.disabled)if(a=w?a.originalEvent.touches:[a],b.corner){var c=b.parent.offset();b.corner.x=a[0].pageX-c.left;b.corner.y=a[0].pageY-c.top;i._showFoldedPage.call(this,b.corner)}else b.hover&&(!this.data().effect&&this.is(":visible"))&&((a=i._isIArea.call(this,a[0]))?(b.status="hover",b=i._c.call(this,a.corner,b.opts.cornerSize/2),a.x=b.x,a.y=b.y,i._showFoldedPage.call(this,a,!0)):"hover"==b.status&&(b.status="",i.hideFoldedPage.call(this,!0)))},_eventEnd:function(){var a=this.data().f,
b=a.corner;!a.disabled&&b&&"prevented"!=v("released",this,[a.point||b])&&i.hideFoldedPage.call(this,!0);a.corner=null},disable:function(a){i.setData.call(this,{disabled:a});return this},hover:function(a){i.setData.call(this,{hover:a});return this},peel:function(a,b){var c=this.data().f;if(a){if(-1==g.inArray(a,i._cAllowed.call(this)))throw p("Corner "+a+" is not permitted");var d=i._c.call(this,a,c.opts.cornerSize/2);c.status="peel";i._showFoldedPage.call(this,{corner:a,x:d.x,y:d.y},b)}else c.status=
"",i.hideFoldedPage.call(this,b);return this}};window.requestAnim=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};g.extend(g.fn,{flip:function(){return P(g(this[0]),i,arguments)},turn:function(){return P(g(this[0]),h,arguments)},transform:function(a,b){var c={};b&&(c[z+"transform-origin"]=b);c[z+"transform"]=a;return this.css(c)},animatef:function(a){var b=
this.data();b.effect&&b.effect.stop();if(a){a.to.length||(a.to=[a.to]);a.from.length||(a.from=[a.from]);for(var c=[],d=a.to.length,e=!0,f=this,h=(new Date).getTime(),i=function(){if(b.effect&&e){for(var g=[],j=Math.min(a.duration,(new Date).getTime()-h),l=0;l<d;l++)g.push(b.effect.easing(1,j,a.from[l],c[l],a.duration));a.frame(d==1?g[0]:g);if(j==a.duration){delete b.effect;f.data(b);a.complete&&a.complete()}else window.requestAnim(i)}},j=0;j<d;j++)c.push(a.to[j]-a.from[j]);b.effect=g.extend({stop:function(){e=
false},easing:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c}},a);this.data(b);i()}else delete b.effect}});g.isTouch=w;g.mouseEvents=t;g.cssPrefix=R;g.cssTransitionEnd=function(){var a,b=document.createElement("fakeelement"),c={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in c)if(void 0!==b.style[a])return c[a]};g.findPos=D})(jQuery);
